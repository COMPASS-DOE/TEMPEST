---
title: 'TEMPEST: TGW 2023 Data Viz'
author: "Stephanie J. Wilson"
date: "2024-05-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(ggpubr)
library(dplyr)
library(plyr)
library(tidyverse)
library(tidyr)
```

## Read in all processed files and combine
```{r}
#read all non-event files and add an event time point 
mar_may <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202303_05_Processed.csv")
july_aug <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202307_08_Processed.csv")
sept_oct <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202309_10_Processed.csv")
nov <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_2023011_Processed.csv")

#add event time stamp
mar_may$Event_Stamp <- NA
july_aug$Event_Stamp <- NA
sept_oct$Event_Stamp <- NA
nov$Event_Stamp <- NA

#read in all event files 
june1 <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202306_T0-1_Processed.csv")
june2 <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202306_T2-3am_Processed.csv")
june3 <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202306_T3pm-4_Processed.csv")
june4 <- read.csv("2023 Processed Data/COMPASS_TEMPEST_TGW_202306_T5_Processed.csv")

#combine into one dataframe 
alldat <- rbind(mar_may, june1, june2, june3, june4, july_aug, sept_oct, nov )
head(alldat)


alldat1 <- alldat[, -c(1:2) ]
alldat1 <- alldat1 %>%  
  filter(!str_detect(Sample_ID, "MSM_TR"))

names(alldat1)[names(alldat1) == 'Tree_ID'] <- 'Sapflux_Tree_ID'

#add sample Tree spp to the data frame 
loci <- read.csv("TEMPEST_TGW_Sample_Locations.csv")
head(loci)

names(loci)[names(loci) == 'Sapflux_ID'] <- 'Sapflux_Tree_ID'

alldat2 <- merge(loci, alldat1, by=c("Sapflux_Tree_ID"))
head(alldat2)


write.csv(alldat2, "2023 Processed Data/TEMPEST_TGW_2023_AllData.csv")

```

## Make list of those that need diluted and write out
```{r}


#subset by those that need to be diluted
dilutions <- subset(alldat, CH4_Flag == "Needs Dilution")

#write out file of the list 
write.csv(dilutions, "2023 Processed Data/TEMPEST_TGW_2023_SamplesToDilute.csv")


```


## Viz March and May  
```{r}
mar_may <- subset(mar_may, Sample_Month == c("March", "May"))

ggplot(data=mar_may, aes(x=Tree_ID, y=CH4_Conc_ppm_dilcorr))+
  geom_point()+ 
  facet_grid(~Sample_Month)+ 
  theme_bw()



```

## Viz monthly? 
```{r}
alldata <- read.csv("2023 Processed Data/TEMPEST_TGW_2023_AllData.csv")
head(alldata)

alldata1 <- alldata %>%  
  filter(!str_detect(Sapflux_Tree_ID, "ATM"))


#visualize data through time 
plot <- ggplot()+
  geom_point(data=alldata1, aes(x=Sample_Month, y=CH4_Conc_ppm_dilcorr, color=Sapflux_Tree_ID), size=2)+ 
  facet_wrap(~Sample_Plot, ncol=1, scales="free")+ 
  theme_bw()+ labs(x="Month", y="CH4 (ppm)", title="2023") + theme(legend.title = element_blank())
plot

plota <- ggplot()+
  geom_point(data=alldata1, aes(x=Sample_Month, y=CH4_Conc_ppm_dilcorr, color=spp), size=2)+ 
  facet_wrap(~Sample_Plot, ncol=1, scales="free")+ 
  scale_color_manual(values=c("darkcyan", "deeppink", "black")) +
  theme_bw()+ labs(x="Month", y="CH4 (ppm)", title="2023") + theme(legend.title = element_blank())
plota

plot1 <- ggplot()+
  geom_boxplot(data=alldata1, aes(x=Sample_Plot, y=CH4_Conc_ppm_dilcorr, color=Sample_Plot))+ 
  scale_color_manual(values=c("darkgreen", "darkblue", "red")) +
  theme_bw()+ labs(x="Plot", y="CH4 (ppm)", title="2023") + theme(legend.title = element_blank())
plot1

plot2 <- ggplot()+
  geom_boxplot(data=alldata1, aes(x=spp, y=CH4_Conc_ppm_dilcorr, color=spp))+ 
  facet_wrap(~Sample_Plot, ncol=1, scales="free")+ 
  scale_color_manual(values=c("darkcyan", "deeppink", "black")) +
  theme_bw()+ labs(x="Plot", y="CH4 (ppm)", title="2023") + theme(legend.title = element_blank())
plot2

```

